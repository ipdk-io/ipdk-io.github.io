<!doctype html>
<html lang="en">
  <head>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">

  

  

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IPDK, or Infrastructure Programmer Development Kit, is an open source, vendor-agnostic framework of drivers and APIs for infrastructure offload and management that runs on a CPU or an IPU.  IPDK runs in Linux and uses a set of well-established tools such as SPDK, DPDK, Quick Assist and P4 to enable network virtualization, storage virtualization, workload provisioning, root-of-trust and offload capabilities found in the platform.  The components within IPDK, already optimized for Xeon servers, provide a common platform across CPUs and IPUs for increasing performance, optimizing resources and securing the infrastructure with an open-source eco-system.
">
  <meta name="author" content="TBD">

  <title>Target Abstraction Interface</title>

  <link rel="stylesheet" href="../../../css/bootstrap.min.css">
  <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto:400,900' type='text/css'>
  <link rel="stylesheet" href="../../../css/spdk.css">
  <link rel="stylesheet" href="../../../css/syntax.css">

  <link href="../../../feed.xml" type="application/atom+xml" rel="alternate" title="Atom Feed">

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
</head>


  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-purp px-2">

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="../../../" aria-label="IPDK">
    <img src="../../../img/ipdk_mark_FIN_REV.svg" width="50" alt="Infrastructure Programmer Development Kit" />
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">

    <div class="navbar-nav mr-auto">
      
      
       <a class="nav-link header-link"  
        href="../../../download/">
        
        
        download
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../documentation/">
        
        
        documentation
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../development/">
        
        
        development
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../ci-status/">
        
        
        CI Status
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../community/">
        
        
        community
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../blog/">
        
        
        News
        
      </a>
      
    </div>

    <div class="navbar-nav ml-auto mr-3">
      <a class="nav-link header-link" href="https://github.com/ipdk-io">
      <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
      </a>
    </div>

  </div>

</nav>


    <div class="container-fluid">
      <div class="row">

        <div class="col-md-3 border-right border-dark">

          <nav class="navbar navbar-expand-md navbar-light">

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navTableOfContents" aria-controls="navTableOfContents" aria-expanded="false" aria-label="Toggle Table of Contents">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navTableOfContents">

              <div class="navbar-nav flex-column">
		<div class="collapse navbar-collapse" id="navTableOfContents">
<div class="navbar-nav flex-column">
  <ul class="no-bullets">
        
          
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Interfaces">Interfaces</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Interfaces/InfraApp">Infrastructure Application Interface</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Interfaces/TargetAbstraction">Target Abstraction Interface</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Recipes">Recipes</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/InfrastructureNetworking">Virtual Networking</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/VirtualBlockStorage">Virtual Block Storage</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/PaaSOffloadKubernetes">Kubernetes Offload</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/FirewallInlineAcceleration">Inline Function Acceleration (Firewall Application)</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Targets">Targets</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/KVMTargetP4DPDK">KVM Target w/ P4 DPDK</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/OCTEON_DPU">OCTEON DPUs</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/MountEvansIPU">Mount Evans IPU</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/OakSpringsCanyonIPU">Oak Springs Canyon IPU</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/TofinoSwitch">Tofino-based Intelligent Switch</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Acronyms">Acronyms Glossary</a>
              
            </li>
            
        
    </ul>
  </div>
</div>
              </div>
            </div>
          </nav>
        </div>

        <div class="col-md-9 py-3 pl-5">

          <div class="jumbotron">
            <h1>Target Abstraction Interface</h1>
          </div>

          <div class="content"><p>The Target Abstraction Interface (TAI) is an abstraction exposed by an infrastructure device running infrastructure applications that serve connected compute instances (attached hosts and/or VMs, which may or may not be containerized).  The infrastructure device may also contain an isolated Infrastructure Manager used to help manage the lifecycle of the device.</p>

<p>The components of the TAI must be:</p>
<ol>
  <li>Standards Based - Curated from existing standards for programmable targets</li>
  <li>Driver &amp; Library Based - Applications in the infrastructure link with the library components of TAI to program the control plane.  Applications in both compute instances and in the infrastructure use device drivers for dataplane operations such as moving packets or stored data.</li>
  <li>Capabilities Based - Curated from standards that have capabilities interfaces such that the applications can query the target to understand its capabilities up front even before the target is deployed.</li>
</ol>

<p>The Target Abstraction Interface is curated to be target independent and target agnostic without being a lowest common denominator interface that ends up obfuscating the target capabilities below it.</p>

<p>The TAI is constituted of:</p>
<ol>
  <li>Virtual Devices:  Device abstractions that the infrastructure can plug into the compute instances that uses it.</li>
  <li>Lifecycle Control:  Control Plane interface for managing the device that the infrastructure is running on (update, monitoring, reset &amp; recovery).</li>
  <li>Accelerator Control:  Control Plane interface for accelerators at the disposal of infrastructure applications</li>
</ol>

<h1 id="virtual-devices">Virtual Devices</h1>

<p>Virtual devices interact with compute instances (hosts and virtual machines, which may also be containerized) using PCI hotplug which is assumed to be supported in the compute instance’s operating system (as it is well supported across the broad set of possible OSes that could be running).</p>

<h2 id="network-devices">Network Devices</h2>

<p>Supported Network Devices:</p>
<ul>
  <li>virtio-net : 0.95 support is mandatory, newer versions can be negotiated</li>
</ul>

<h2 id="block-storage-devices">Block Storage Devices</h2>

<p>Supported storage devices:</p>
<ul>
  <li>virtio-blk : 0.95 support is mandatory, newer versions can be negotiated including virtio-scsi</li>
  <li>NVMe : supported a disk controller device which can hold multiple block devices using namespaces</li>
</ul>

<h1 id="lifecycle-control">Lifecycle Control</h1>

<p>Infrastructure ‘devices’ operate independently from the compute instances that they serve (whether these instances are hosts or VMs).  This creates three independent domains that can be powered up, down and reset from the Lifecycle Control interface:</p>

<ul>
  <li>Instance Domain(s) - one or more</li>
  <li>Infrastructure Device Domain - one</li>
  <li>Infrastructure Management Domain - zero or one</li>
</ul>

<p>In certain systems these domains are not fully independent, and one capability of Lifecycle Control is to report up to management applications where domains are tied together (shared fate).</p>

<p>The lifecycle commands below can be invoked locally through an API or accessed through a control protocol in the Infrastructure Application Interface (ie redfish).</p>

<p>Mandatory lifecycle commands</p>
<ul>
  <li>soft power up/down (domain) : Given the supplied domain, set the soft power to this domain</li>
  <li>hard power up/down (domain) : Given the supplied domain, set the hard power to this domain</li>
  <li>reboot (domain) : Given the supplied domain, trigger a reboot</li>
  <li>readlog (domain) : Given the supplied domain, read out the current log.</li>
  <li>clearlog (domain, entries) : Given the supplied domain, clear out the log entries specified.</li>
  <li>readdump (domain) : Given the supplied domain, read out the latest core dump.</li>
  <li>cleardump (domain, entries) : Given the supplied domain, clear out the core dump entries specified</li>
  <li>add boot source (domain, config) : Given the supplied domain, configure a boot source for that domain.  Configuration can be boot from PXE, network, or local disk.</li>
  <li>set boot order (domain, order) :  Given the supplied domain, configure the boot order based on availability of the boot sources provided in the above command.</li>
  <li>recover (domain) : Attempt to boot the supplied domain into its immutable recovery boot source</li>
</ul>

<p>Optional lifecycle commands</p>
<ul>
  <li>add / remove image : Load images into the infrastructure to be associated with a domain’s boot source.</li>
  <li>set time server : Set up a time server for use in the infrastructure</li>
  <li>set name server : Set up a name server for use in the infrastructure</li>
  <li>revoke key : Revoke a key used for the secure booting of a domain</li>
</ul>

<h1 id="accelerator-control">Accelerator Control</h1>

<p>Accelerator Control can be qualified as consisting of two types of components:  device libraries w/ APIs and device drivers.</p>

<h2 id="api-linkable-libraries">API Linkable Libraries</h2>

<ul>
  <li><a href="https://github.com/p4lang/tdi">Table Driven Interface</a> : A linkable library API that is target agnostic and enables targets to be dynamically linked with applications at runtime.  The TDI sits at the bottom of the P4Runtime and OpenConfig servers inside IPDK enabling a generic API to all possible targets.  This facilitates compiler driven config space (using p4info) as well as static table config space used in OpenConfig (physical devices, virtual devices, QoS, management).</li>
  <li>SAI-to-TDI : A wrapper around TDI to provide SAI (Switch Abstraction Interface) APIs to an application on top of a target that supports TDI and is running a SAI compatible P4 program.</li>
  <li>Programmable Tables : Tables derived from the compilation of P4 programs into the target.  These tables are defined by the p4info artifacts that are produced after successful compilation.  These programmable tables are focused on the networking dataplane- switching, routing, flows, ACLs, tunnels, connection tracking, etc. including any inline functions such as inline crypto.  For the SAI interface to be supported there must be mappings from SAI into the programmable tables (for example mapping routing operations to routing tables).</li>
  <li>Fixed Tables : Tables defined in a schema and agreed upon by the application and the target as being required for this usage.
    <ul>
      <li>Link Management :  The management of networking links coming in and out of the infrastructure device
        <ul>
          <li>Get/Set PHY Config &amp; Debug</li>
          <li>Get/Set MAC Config</li>
          <li>Get Link Status</li>
          <li>Link Setup, Auto-Negotiation</li>
        </ul>
      </li>
      <li>Virtual Device Management :  The management of virtual devices presented up into compute instances.  These are represented in a hash table based on a device key
        <ul>
          <li>add/remove virtual-device <name> <instance> <type> <config> <state>
</state></config></type></instance></name>            <ul>
              <li>Name:  Unique String per device</li>
              <li>Instance:  Instance to associate with the device, leave blank if there is only one instance</li>
              <li>Type:  One from the set of supported types: virtio-net, virtio-blk, virtio-scsi, NVMe.</li>
              <li>Config:  All devices will have the following shared config:
                <ul>
                  <li>Config Version:  Version of this config object, default is 1</li>
                  <li>Device Version:  Device specific version for example 0.95 or 1.0 for virtio.  Default is zero which disables the rate limiter</li>
                  <li>Config Bandwidth Limit:  Requested bandwidth limit, in Megabits per second.  Default is zero which disables the rate limiter</li>
                  <li>Config Requests/sec Limit:  Requested requests/sec (for a port this is transmit packets/sec), in Requests per second</li>
                  <li>Admin:  Set to DOWN to disable the device.  Default is UP</li>
                  <li>Host Virtual Device:  For host virtualization on an infrastructure device only.  Specify the hardware device on the host to associate this virtual device with.  Default is zero which implies hot plug.</li>
                  <li>Host Virtual Function:  For host virtualization on an infrastructure device only.  Specify the virtual function on the host virtual device to associate this virtual device with.  Default is zero which implies hot plug.</li>
                </ul>
              </li>
              <li>Stats:  All devices will have the following shared statistics:
                <ul>
                  <li>Statistics Version:  Version of the stats object, default is 1</li>
                  <li>Status:  String representing the device state (UP, DOWN, ERROR)</li>
                  <li>Instance Config:  String representing this device’s configuration into the instance</li>
                  <li>Transmit Bytes:  Number of bytes transmitted by the instance’s driver</li>
                  <li>Transmit Packets:  Number of packets/requests transmitted by the instance’s driver</li>
                  <li>Receive Bytes:  Number of bytes received by the instance’s driver</li>
                  <li>Receive Packets:  Number of packets/requests received by the instance’s driver</li>
                  <li>Actual Bandwidth Limit:  Device’s bandwidth limit, in Megabits per second.  Zero means no limit is running on the device.  May differ from requested limit.</li>
                  <li>Actual Requests/sec Limit:  Requested requests/sec (for a port this is transmit packets/sec), in Requests per second.  Zero means no limit is running on the device.  May differ from requested limit.</li>
                  <li>Discard Bytes:  Number of bytes sent from the instance’s driver that were discarded by the device</li>
                  <li>Discard Packets:  Number of packets sent from the instance’s driver that were discarded by the device</li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <ul>
      <li>QoS Management:  The management of QoS elements in the dataplane, reflecting the amount of hierarchy and capabilities within each level</li>
    </ul>
  </li>
  <li>
    <ul>
      <li>IPsec Management:  For inline crypto (when supported) the loading of security associations and associating them with an index to be used in other places in the dataplane</li>
    </ul>
  </li>
</ul>

<h2 id="device-drivers">Device Drivers</h2>

<p>Supported Devices</p>
<ul>
  <li>Linux netdev : Used for moving traffic in and out of the infrastructure, between the instances and infrastructure device as well as between the network and the infrastructure device.</li>
  <li>Inverse block device :  Used for moving storage requests and completions between instances and the infrastructure device.  Block storage requests arrive from the instance(s) and in the other direction block storage completions form the infrastructure device’s responses to these requests.</li>
  <li>Crypto device :  Used by infrastructure applications to pass data to a lookaside crypto engine that is returned either encrypted or decrypted.</li>
  <li>Compress device : Used by the infrastructure applications to pass data to a lookaside compression engine that is either compressed or decompressed.</li>
</ul>
</div>
        </div>
      </div>
    </div>

    
  </body>
</html>
