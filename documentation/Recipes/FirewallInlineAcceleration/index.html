<!doctype html>
<html lang="en">
  <head>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">

  

  

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IPDK, or Infrastructure Programmer Development Kit, is an open source, vendor-agnostic framework of drivers and APIs for infrastructure offload and management that runs on a CPU or an IPU.  IPDK runs in Linux and uses a set of well-established tools such as SPDK, DPDK, Quick Assist and P4 to enable network virtualization, storage virtualization, workload provisioning, root-of-trust and offload capabilities found in the platform.  The components within IPDK, already optimized for Xeon servers, provide a common platform across CPUs and IPUs for increasing performance, optimizing resources and securing the infrastructure with an open-source eco-system.
">
  <meta name="author" content="TBD">

  <title>Inline Function Acceleration</title>

  <link rel="stylesheet" href="../../../css/bootstrap.min.css">
  <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto:400,900' type='text/css'>
  <link rel="stylesheet" href="../../../css/spdk.css">
  <link rel="stylesheet" href="../../../css/syntax.css">

  <link href="../../../feed.xml" type="application/atom+xml" rel="alternate" title="Atom Feed">

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
</head>


  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-purp px-2">

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="../../../" aria-label="IPDK">
    <img src="../../../img/ipdk_mark_FIN_REV.svg" width="50" alt="Infrastructure Programmer Development Kit" />
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">

    <div class="navbar-nav mr-auto">
      
      
       <a class="nav-link header-link"  
        href="../../../documentation/">
        
        
        documentation
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../development/">
        
        
        development
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../community/">
        
        
        community
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../blog/">
        
        
        News
        
      </a>
      
    </div>

    <div class="navbar-nav ml-auto mr-3">
      <a class="nav-link header-link" href="https://github.com/ipdk-io">
      <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
      </a>
    </div>

  </div>

</nav>


    <div class="container-fluid">
      <div class="row">

        <div class="col-md-3 border-right border-dark">

          <nav class="navbar navbar-expand-md navbar-light">

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navTableOfContents" aria-controls="navTableOfContents" aria-expanded="false" aria-label="Toggle Table of Contents">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navTableOfContents">

              <div class="navbar-nav flex-column">
		<div class="collapse navbar-collapse" id="navTableOfContents">
<div class="navbar-nav flex-column">
  <ul class="no-bullets">
        
          
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Interfaces">Interfaces</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Interfaces/InfraApp">Infrastructure Application Interface</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Interfaces/TargetAbstraction">Target Abstraction Interface</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Recipes">Recipes</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/InfrastructureNetworking">Virtual Networking</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/VirtualBlockStorage">Virtual Block Storage</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/PaaSOffloadKubernetes">Kubernetes Offload</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/FirewallInlineAcceleration">Inline Function Acceleration (Firewall Application)</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Targets">Targets</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/KVMTargetP4DPDK">KVM Target w/ P4 DPDK</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/OCTEON_DPU">OCTEON DPUs</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/MountEvansIPU">Mount Evans IPU</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/OakSpringsCanyonIPU">Oak Springs Canyon IPU</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/TofinoSwitch">Tofino-based Intelligent Switch</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Acronyms">Acronyms Glossary</a>
              
            </li>
            
        
    </ul>
  </div>
</div>
              </div>
            </div>
          </nav>
        </div>

        <div class="col-md-9 py-3 pl-5">

          <div class="jumbotron">
            <h1>Inline Function Acceleration</h1>
          </div>

          <div class="content"><h1 id="firewall-function-acceleration">Firewall Function Acceleration</h1>

<p>An inline network service is a function inserted into the datapath of a networking device (could be software, IPU or switch datapath). The inline networked device needs to be a full participant in the network (by either peering with the networking at L3 or having ingress/egress ports that the inline network controller can use to re-direct traffic through it). In this recipe this is accomplished by building on top of the Infrastructure Networking model through the gNMI OpenConfig and p4Runtime APIs. The initial Infrastructure Networking model is based on the <a href="https://ipdk.io/documentation/Recipes/InfrastructureNetworking/">P4-OVS recipe</a>. It is also possible to build this on top of SONiC which has recently been expanded to also support a P4 (P4 Integrated Network Stack (PINS)) feature add.</p>

<p>The P4 OVS or SONiC is used to peer with the rest of the network, and then P4Runtime and OpenConfig are used by the control plane implementing the inline network service to insert the pipeline into the networking datapath. The P4 compiler will inform the control plane if its P4 pipeline dataplane requirements are supported by the device. The OpenConfig interface can be queried to test if the required configuration schema can be supported by the device as well.</p>

<p><img src="../img/Inline-Firewall-P4-OVS.png" alt="P4 OVS" title="P4 OVS" width="40%" /></p>

<p>In this document we provide the recipe firewall use case inline acceleration for Xeon platform only. As explained in the IPDK <a href="https://ipdk.io/documentation/Recipes/InfrastructureNetworking/">P4-OVS recipe</a>, only the virtio-net virtual device type is supported to the tenant instance.</p>

<h1 id="example-firewall-flow-assist-use-case">Example Firewall flow-assist use case</h1>

<p><a href="https://github.com/FDio/vpp">VPP</a> executes as a network function on host/VM where IPDK provides I/O connectivity and a network acceleration service. The network function directly configures and manages flows in the IPDK for inline networking domain. The selection criteria for acceleration could be lifetime of flow (e.g., long-lived flows) or features required (e.g., flow not requiring inspection).</p>

<p><img src="../img/Inline-Firewall-Acceleration.png" alt="Firewall Acceleration Scenario" title="Firewall Acceleration Scenario" width="60%" /></p>

<p>The above figure shows the slow path and fast path scenario for typical firewall use case where network function can be accelerated for IP/ACL functions, content inspections, NAT, route operations etc. In this document we provide the example implementation which accelerates the IP/ACL functions only.</p>

<h1 id="example-implementation-details">Example Implementation Details</h1>

<p>Figure below shows the detailed architecture of example firewall flow-assist scenario. The P4-OVS comes with tools like gnmi-cli and p4ctl which uses OpenConfig and P4Runtime interfaces.</p>

<p><img src="../img/Inline-Firewall-Acceleration-Flow.png" alt="Firewall Acceleration Flow" title="Firewall Acceleration Flow" width="60%" /></p>

<p>Using gnmi-cli Over OpenConfig, several virtual ports (e.g., vhost) are created which are attached to the port devices connected to the VMs for the datapath connectivity. The tenant instance (VPP application as firewall) loads the corresponding driver (e.g., virtio) for that device and can send/receive traffic.</p>

<p>A firewall.p4 program defines the dataplane to be used with P4-OVS. A firewall.p4info file also generated by compiling the firewall.p4 and is consumed by the virtio driver within host/VM to be aware about the pipeline tables and actions. The control application writes some default rules in the pipeline to determine the direction of the traffic.</p>

<p>In the above figure, 2 VMs are used where one VM is running pktgen application as traffic generator and second VM is running VPP application firewall tenant. In the ingress path, upon receiving the first packet from pktgen, the pipeline uses longest prefix match and determines the direction of the packet. Since there is no flow was programmed from the tenant (VPP as firewall workload), the packet is considered as an exception packet and forwarded to the tenant. The tenant then determines validity of the flow and program a rule to P4-OVS and send the packet back to the P4-OVS.</p>

<p>The driver (virtio in this example) in tenant implements DPDK rte_flow API to program the flow. Upon receiving the flow programming request, the driver programs the flow in P4-OVS using P4Runtime interface. In this example article, the action is to send the packet back to the packet generator. Any subsequent packets received by the pipeline in P4-OVS from the traffic generator, will hit the programmed rule and forwarded back to the packet generator instead going via tenant.</p>

<h1 id="build-script">Build Script</h1>

<p>Find more information on how to build this <a href="https://github.com/ipdk-io/ipdk/blob/main/build/inline_acceleration/firewall/README.md" title="Firewall Inline Function Acceleration">here</a>.</p>
</div>
        </div>
      </div>
    </div>

    
  </body>
</html>
