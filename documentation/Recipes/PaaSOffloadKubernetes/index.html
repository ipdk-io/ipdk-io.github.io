<!doctype html>
<html lang="en">
  <head>
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">

  

  

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="IPDK, or Infrastructure Programmer Development Kit, is an open source, vendor-agnostic framework of drivers and APIs for infrastructure offload and management that runs on a CPU or an IPU.  IPDK runs in Linux and uses a set of well-established tools such as SPDK, DPDK, Quick Assist and P4 to enable network virtualization, storage virtualization, workload provisioning, root-of-trust and offload capabilities found in the platform.  The components within IPDK, already optimized for Xeon servers, provide a common platform across CPUs and IPUs for increasing performance, optimizing resources and securing the infrastructure with an open-source eco-system.
">
  <meta name="author" content="TBD">

  <title>PaaS Offload - Kubernetes</title>

  <link rel="stylesheet" href="../../../css/bootstrap.min.css">
  <link rel="stylesheet" href='https://fonts.googleapis.com/css?family=Roboto:400,900' type='text/css'>
  <link rel="stylesheet" href="../../../css/spdk.css">
  <link rel="stylesheet" href="../../../css/syntax.css">

  <link href="../../../feed.xml" type="application/atom+xml" rel="alternate" title="Atom Feed">

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>
</head>


  <body>
    <nav class="navbar navbar-expand-md navbar-dark bg-purp px-2">

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <a class="navbar-brand" href="../../../" aria-label="IPDK">
    <img src="../../../img/ipdk_mark_FIN_REV.svg" width="50" alt="Infrastructure Programmer Development Kit" />
  </a>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">

    <div class="navbar-nav mr-auto">
      
      
       <a class="nav-link header-link"  
        href="../../../download/">
        
        
        download
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../documentation/">
        
        
        documentation
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../development/">
        
        
        development
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../ci-status/">
        
        
        CI Status
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../community/">
        
        
        community
        
      </a>
      
      
       <a class="nav-link header-link"  
        href="../../../blog/">
        
        
        News
        
      </a>
      
    </div>

    <div class="navbar-nav ml-auto mr-3">
      <a class="nav-link header-link" href="https://github.com/ipdk-io">
      <svg xmlns="http://www.w3.org/2000/svg" class="navbar-nav-svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
      </a>
    </div>

  </div>

</nav>


    <div class="container-fluid">
      <div class="row">

        <div class="col-md-3 border-right border-dark">

          <nav class="navbar navbar-expand-md navbar-light">

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navTableOfContents" aria-controls="navTableOfContents" aria-expanded="false" aria-label="Toggle Table of Contents">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navTableOfContents">

              <div class="navbar-nav flex-column">
		<div class="collapse navbar-collapse" id="navTableOfContents">
<div class="navbar-nav flex-column">
  <ul class="no-bullets">
        
          
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Interfaces">Interfaces</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Interfaces/InfraApp">Infrastructure Application Interface</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Interfaces/TargetAbstraction">Target Abstraction Interface</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Recipes">Recipes</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/InfrastructureNetworking">Virtual Networking</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/VirtualBlockStorage">Virtual Block Storage</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/InlineIPsec">Inline IPsec</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/PaaSOffloadKubernetes">Kubernetes Offload</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Recipes/FirewallInlineAcceleration">Inline Function Acceleration (Firewall Application)</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Targets">Targets</a>
              
                <ul class="no-bullets">
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/KVMTargetP4DPDK">KVM Target w/ P4 DPDK</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/OCTEON_DPU">OCTEON DPUs</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/MountEvansIPU">Mount Evans IPU</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/OakSpringsCanyonIPU">Oak Springs Canyon IPU</a>
                        
                      </li>
                  
                      <li class="nav-item">
                        <a href="../../../documentation/Targets/TofinoSwitch">Tofino-based Intelligent Switch</a>
                        
                      </li>
                  
                </ul>
              
            </li>
            
          <li class="nav-item">
            <a class="text-wrap collapsed" href="../../../documentation/Acronyms">Acronyms Glossary</a>
              
            </li>
            
        
    </ul>
  </div>
</div>
              </div>
            </div>
          </nav>
        </div>

        <div class="col-md-9 py-3 pl-5">

          <div class="jumbotron">
            <h1>PaaS Offload - Kubernetes</h1>
          </div>

          <div class="content"><iframe width="560" height="315" src="https://www.youtube.com/embed/7Nk0ljPSE-8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>

<h1 id="infrastructure-application-interface">Infrastructure Application Interface</h1>

<ul>
  <li><strong>Deployment Yaml</strong> : Existing interface to deploy container pods and configure their networking.</li>
  <li><strong>K8s Infrastructure gRPC</strong> : gRPC used between the K8s networking infrastructure and the CNI providing the network interface to the container pods.</li>
  <li><strong>Container Dedicated Queues (CDQs)</strong> :  An optional enhancement that enables dedicated hardware queues from the infrastructure to be allocated to individual container pods, providing a direct connection between the pod and the infrastructure without any intervening software layers that would normally impact performance.</li>
</ul>

<p>In this recipe the ‘Infrastructure’ functionality of Kubernetes networking is split out into a ‘Manager’ function separate from the CNI that interfaces with the business logic running in the pod.  The CNI communicates to the Infrastructure component through this <em>K8s Infrastructure gRPC</em>.  This is going to separate the k8s infrastructure from the business logic, enabling it to run somewhere else, for example on an IPU.</p>

<h1 id="target-abstraction-interface">Target Abstraction Interface</h1>

<ul>
  <li><strong>Calico P4 Plug-in</strong> : Calico is used to interconnect the pods together, apply ACLs and enable dynamic load balancing across services.  Using Calico’s plug-in interface the dataplane commands to enable these functions are convereted into P4 and applied into Open vSwitch using P4Runtime.  This is similar is spirit to the Calico plug-in for VPP.</li>
  <li><strong>k8s.p4</strong> :  Portable NIC Architecture (PNA) program for routing, ACLs, connection tracking and load balancing that defines the dataplane functionality required from Calico.  This replaces the kernel dataplane (iptables, iproute, etc.) and needs to be combined with the kernel dataplane functionality around tunneling, bridging, mirroring, etc.</li>
</ul>

<p>By defining the dataplane in P4 we can use the compiler to determine if a target can support the requirements needed by Calico to interconnect the pods.  Existing kernel functionality must also be supported to preserve existing semantics around monitoring, telemetry, network virtualization, etc.  Features supported by Calico:</p>

<ul>
  <li>Port/interface addition to Namespace</li>
  <li>Policy - Global Network set, host endpoint, Network Policy</li>
  <li>Routing - BGP (bird)</li>
  <li>NAT</li>
  <li>load balancing - workload info if available through policy of K8s.</li>
  <li>NodePort - External connectivity</li>
</ul>

<h2 id="target-audience">Target Audience</h2>
<p>Infrastructure programmers with existing Container networking deployment using K8s and its CNI PlugIns and are looking for a recipe to begin porting them for either better performance/programmability on CPU cores and/or easier adoption of a hardware pipeline inside an IPU to reduce the CPU tax of deploying Containers.</p>
<h2 id="success-criteria">Success Criteria:</h2>
<p>Running P4 Kubernetes CNI agents on the IPU, configure a container to container network and interconnect pods running on the host, connected to the IPU via container dedicated queues (CDQ).  Measure the performance improvement (requests/second, bandwidth) and increase in scale on the host side.</p>
<h2 id="ingredients">Ingredients</h2>
<p>Following are the ingredients of this.</p>
<ul>
  <li>CNI Agent &amp; Manager Agent</li>
  <li>Calico w/ P4 plug-in deployment on K8s.</li>
  <li>OVS with P4Runtime gRPC</li>
  <li>P4 Target Backend (P4 DPDK or IPU Target)</li>
  <li>Test Infrastructure</li>
  <li>Deployment Model - K8s based deployment with Calico as CNI. CDQ on Xeon host injected in container namespace. The rule programming on CNI agent side will be sent directly to the infrastructure, which will also contain a datastore to save configuration conversions and runtime configurations.</li>
</ul>

<h1 id="development">Development</h1>

<p>This Recipe is in development using the <a href="https://join.slack.com/t/ipdkworkspace/shared_invite/zt-xb97bi1d-Q0NY9YC3PYv3LTw~HngVbA" title="IPDK Slack">Slack</a> for coordination.  This Recipe does not include any OpenStack components or kubernetes native component changes. All configuration is managed at a lower layer so that upper layer are not affected.</p>
</div>
        </div>
      </div>
    </div>

    
  </body>
</html>
